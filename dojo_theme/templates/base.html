{% set dojo_id = dojo.reference_id if dojo else None %}
{% set module_id = module.id if module else None %}

<!DOCTYPE html>
<html>
  <head>
    <title>{{ Configs.ctf_name }}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:title" content="pwn.college">
    <meta property="og:description" content="Learn to Hack!">
    <meta property="og:image" content="{{ url_for('views.themes', path='img/dojo/ninja.png', _external=True) }}">

    <link rel="icon" href="{{ url_for('views.themes', path='img/favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('views.themes', path='css/fonts.css') }}">
    <link rel="stylesheet" href="{{ url_for('views.themes', path='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('views.themes', path='css/core.css') }}">
    <link rel="preload" href="{{ url_for('views.themes', path='font/SpaceMono-Regular.ttf') }}" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="{{ url_for('views.themes', path='font/SpaceMono-Bold.ttf') }}" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="{{ url_for('views.themes', path='font/SpaceGrotesk-VariableFont_wght.ttf') }}" as="font" type="font/ttf" crossorigin="anonymous">
    <style>
      @font-face {
        font-family: 'Space Mono';
        src: url("{{ url_for('views.themes', path='font/SpaceMono-Regular.ttf') }}") format('truetype');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      @font-face {
        font-family: 'Space Mono';
        src: url("{{ url_for('views.themes', path='font/SpaceMono-Bold.ttf') }}") format('truetype');
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }

      @font-face {
        font-family: 'Space Grotesk';
        src: url("{{ url_for('views.themes', path='font/SpaceGrotesk-VariableFont_wght.ttf') }}") format('truetype');
        font-weight: 100 900;
        font-style: normal;
        font-display: swap;
      }
    </style>
    <link rel="stylesheet" href="{{ url_for('views.themes', path='css/custom.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    {% block stylesheets %}
    {% endblock %}

    {{ Plugins.styles }}
    <script type="text/javascript">
      var init = {
	  'urlRoot': "{{ request.script_root }}",
	  'csrfNonce': "{{ Session.nonce }}",
	  'userMode': "{{ Configs.user_mode }}",
	  'userId': {{ Session.id }},
	  'start': {{ Configs.start | tojson }},
	  'end': {{ Configs.end | tojson }},
	  'theme_settings': {{ Configs.theme_settings | tojson }},
          'dojo': "{{ dojo_id if dojo else '' }}",
          'module': "{{ module_id if module else '' }}"
      }
    </script>
    {{ Configs.theme_header }}
  </head>
  <body>
    {% include "components/navbar.html" %}

    <main role="main">
      {% block content %}
      {{ content | safe}}
      {% endblock %}
    </main>

    <footer class="footer">
      <div class="container text-center" style="line-height: 20px; opacity: 0.7">
        <small>
          Powered by <strong>pwn.college</strong><br>
          Interested in dedicated training or tailored services for your organization?
          <a href="https://llc.pwn.college/">Find out more</a>.
        </small>
      </div>
    </footer>

    <script defer src="{{ url_for('views.themes', path='js/vendor.bundle.js') }}"></script>
    <script defer src="{{ url_for('views.themes', path='js/core.js') }}"></script>
    <script defer src="{{ url_for('views.themes', path='js/helpers.js') }}"></script>

    {% block entrypoint %}
    <script defer src="{{ url_for('views.themes', path='js/pages/main.js') }}"></script>
    {% endblock %}

    <script defer src="{{ url_for('views.themes', path='js/dojo/util.js') }}"></script>
    <script defer src="{{ url_for('views.themes', path='js/dojo/navbar.js') }}"></script>
    <script defer src="{{ url_for('views.themes', path='js/dojo/popup.js') }}"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    {% block scripts %}
    {% endblock %}

    <script>
      window.addEventListener('load', function() {
        if (typeof renderMathInElement !== 'undefined') {
          renderMathInElement(document.body, {
            delimiters: [
              {left: '\\[', right: '\\]', display: true},
              {left: '\\(', right: '\\)', display: false}
            ],
            throwOnError: false,
            strict: false,
            ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          });
        }
      });
    </script>

    {{ Plugins.scripts }}

    {{ Configs.theme_footer }}

    {% if current_dojo_challenge %}
    <script>
      window.challenge = {{ current_dojo_challenge | tojson }}
    </script>
    {% endif %}
    {% if current_dojo_custom_js %}
    <script>
    {{ current_dojo_custom_js | safe }}
    </script>
    {% endif %}

  <div id="future-announcement" class="announcement" style="display: none">
    <div class="announcement-content">
      <p>Hey! We are developing a new look for our website, currently live at <a href="https://future.pwn.college">future.pwn.college</a>.</p>
      <div class="announcement-btn-wrap">
        <button id="check-it-out-btn" class="announcement-btn">I'll check it out</button>
        <button id="later-btn" class="announcement-btn">Go away</button>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const announcement = document.getElementById("future-announcement");
      const checkItOutBtn = document.getElementById("check-it-out-btn");
      const laterBtn = document.getElementById("later-btn");

      if (!localStorage.getItem("announcementDismissed")) {
        announcement.style.display = "flex";
      }

      function goToFuture() {
        localStorage.setItem("announcementDismissed", "true");
        window.location.href = "https://future.pwn.college";
      }

      function dismiss() {
        announcement.style.display = "none";
        localStorage.setItem("announcementDismissed", "true");
      }

      checkItOutBtn.onclick = goToFuture;
      laterBtn.onclick = dismiss;
    });
  </script>
  </body>
</html>
